{"id":"wortex-3p8","title":"Another test with metadata","description":"\u003c!-- type: task --\u003e","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-02-05T14:55:30.185742-05:00","updated_at":"2026-02-05T14:55:46.777701-05:00","deleted_at":"2026-02-05T14:55:46.777701-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-9te","title":"Another test issue","description":"Another description","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-02-05T14:55:07.038546-05:00","updated_at":"2026-02-05T14:55:20.37539-05:00","deleted_at":"2026-02-05T14:55:20.37539-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9","title":"Agent Orchestration","description":"Enable multiple agents to work in parallel with the ability to observe each other's status and activity. Transforms wortex from managing opaque processes to orchestrating agents with visibility into their status, blocked states, and activity. Introduces MCP-based inter-agent communication, human-controlled intervention commands, and a consolidated SQLite database.\n\nSource: openspec/changes/agent-orchestration\n\nKey changes:\n- Migrate from state.json to wortex.db (SQLite)\n- Add --dir and --worktree flags for process spawning\n- Capture PermissionRequest and Notification hooks\n- Detect blocked states (ask_user, permission)\n- Add respond/allow/deny/attach commands\n- Add wortex mcp-serve for agent-to-agent visibility\n- Inject .claude/settings.local.json per process","status":"open","priority":1,"issue_type":"epic","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:56:02.609412-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T14:56:02.609412-05:00","labels":["agent-orchestration"]}
{"id":"wortex-bp9.1","title":"Create unified schema in db.rs with processes and tool_calls tables","description":"Create a new db.rs module with unified SQLite schema. The processes table needs columns for: id, name, directory, branch, tmux_session, pid, status (spawned/active/blocked/exited), blocked_on, exit_code, prompt, created_at, updated_at. The tool_calls table needs: id, process_id, tool_name, tool_input (JSON), hook_type (pre/post/permission/notification), timestamp, sequence. Use WAL mode for concurrent access.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:05.655772-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","database"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.10","title":"Refactor commands/new.rs to support --worktree mode","description":"Refactor commands/new.rs so that when --worktree is provided, a git worktree is created first, then the process spawns in it. Support --base flag for specifying the source branch.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:29.010455-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","spawning"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.11","title":"Implement settings.local.json creation/merge in target directory","description":"When spawning a process, create or merge .claude/settings.local.json in the target directory. If file doesn't exist, create it with hook and MCP config. If it exists, merge without overwriting existing settings. Include mcpServers.wortex configuration and all hook entries.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:29.091641-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","spawning"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.12","title":"Configure hooks in settings.local.json","description":"Configure PreToolUse, PostToolUse, PermissionRequest, and Notification hooks in the injected settings.local.json. Each hook calls 'wortex hook \u003ctype\u003e \u003cprocess-id\u003e' with the appropriate type argument. The process-id comes from WORTEX_PROCESS_ID env var.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:29.17354-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","hooks","spawning"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.13","title":"Set WORTEX_PROCESS_ID environment variable when spawning","description":"When spawning a process via wortex new, set the WORTEX_PROCESS_ID environment variable to the process UUID. This allows hook commands to identify which process triggered them.","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:29.257319-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","spawning"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.14","title":"Add wortex hook permission command","description":"Add 'wortex hook permission \u003cprocess-id\u003e' command. Reads JSON from stdin, parses tool_name and request payload, inserts record into tool_calls with hook_type='permission', and sets process status to blocked/permission.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:55.7638-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","hooks"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.15","title":"Add wortex hook notification command","description":"Add 'wortex hook notification \u003cprocess-id\u003e' command. Reads JSON from stdin, parses message content, inserts record into tool_calls with hook_type='notification'. Does not change process blocked state.","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:55.852396-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","hooks"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.16","title":"Update hook handler to set blocked status on PreToolUse(AskUserQuestion)","description":"When the PreToolUse hook fires with tool_name='AskUserQuestion', set the process status to 'blocked' and blocked_on to 'ask_user'. This signals the agent is waiting for user input.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:55.949503-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","hooks","status"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.17","title":"Update hook handler to clear blocked status on PostToolUse(AskUserQuestion)","description":"When the PostToolUse hook fires with tool_name='AskUserQuestion', set the process status back to 'active' and clear blocked_on. This signals the agent received input and resumed.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:56.03996-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","hooks","status"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.18","title":"Update hook handler to set blocked status on PermissionRequest","description":"When the PermissionRequest hook fires, set the process status to 'blocked' and blocked_on to 'permission'. This signals the agent is waiting for permission approval.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:56.125362-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","hooks","status"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.19","title":"Update db.rs to record hook_type for all events","description":"Ensure all hook event inserts into tool_calls include the hook_type field (pre/post/permission/notification). Update existing PreToolUse and PostToolUse handlers to set hook_type='pre' and hook_type='post' respectively.","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:56.206535-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","database","hooks"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.2","title":"Add migration logic: detect old state.json, import to wortex.db, backup and remove","description":"On first run, check for ~/.wortex/state.json. If it exists, read all process entries and insert them into the new processes table in wortex.db. Migrate tool_calls from tools.db if present. Backup old files (state.json.bak, tools.db.bak) and remove originals. Log migration progress.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:05.746395-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","database"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.20","title":"Implement status derivation logic","description":"Implement status derivation for processes: spawned (just created, no activity yet), active (receiving tool call events, not blocked), blocked (PreToolUse AskUserQuestion or PermissionRequest without resolution), exited (PID no longer exists). Status is derived from hook events and process liveness.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:08.204266-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","status"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.21","title":"Add process liveness check","description":"Add process liveness check using kill -0 on the stored PID (or /proc/\u003cpid\u003e on Linux). When the PID no longer exists, transition the process status to 'exited' and record the exit_code if available. Run this check when querying process status.","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:08.297884-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","status"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.22","title":"Update wortex status command with blocked state display","description":"Update 'wortex status \u003cname\u003e' to show blocked state information. When blocked on ask_user: show 'blocked (waiting for input)' and duration. When blocked on permission: show 'blocked (waiting for permission)' and duration. When active: show 'active' with last tool used and when.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:08.387632-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","cli","status"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.23","title":"Update wortex list command with status columns","description":"Update 'wortex list' to show status and blocked_on columns in the summary table. Each row should display: name, status, blocked_on (if any), last activity timestamp.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:08.472989-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","cli","status"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.24","title":"Add wortex respond command","description":"Add 'wortex respond \u003cname\u003e \u003ctext\u003e' command in cli.rs. Routes to commands/respond.rs.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:35.579446-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","cli","interaction"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.25","title":"Implement respond using tmux send-keys","description":"Implement respond in commands/respond.rs. Uses tmux send-keys to inject the text followed by Enter into the agent's tmux pane. The text is sent to the agent waiting for AskUserQuestion input.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:35.749505-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","interaction"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.26","title":"Add validation: only respond when blocked on ask_user","description":"Before sending the response, validate that the target agent exists and is blocked on 'ask_user'. If not blocked: error 'Agent \u003cname\u003e is not waiting for input'. If not found: error 'Agent \u003cname\u003e not found'.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:35.848309-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","interaction"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.27","title":"Add wortex allow command","description":"Add 'wortex allow \u003cname\u003e' command in cli.rs. Implement in commands/allow.rs using tmux send-keys to send 'y' followed by Enter. Validates agent is blocked on PermissionRequest first. Error if not: 'Agent \u003cname\u003e has no pending permission request'.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:35.948163-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","cli","interaction"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.28","title":"Add wortex deny command","description":"Add 'wortex deny \u003cname\u003e' command in cli.rs. Implement in commands/deny.rs using tmux send-keys to send 'n' followed by Enter. Validates agent is blocked on PermissionRequest first. Error if not: 'Agent \u003cname\u003e has no pending permission request'.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:36.05126-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","cli","interaction"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.29","title":"Add validation: only allow/deny when blocked on permission","description":"Shared validation logic for allow and deny commands. Check that the target agent exists, is in 'blocked' status, and blocked_on is 'permission'. Return appropriate error messages for each failure case.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:36.134131-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","interaction"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.3","title":"Update state.rs to use SQLite instead of JSON","description":"Refactor state.rs to read/write process state from wortex.db instead of state.json. All existing functions that serialize/deserialize JSON state should be replaced with SQLite queries. Consider consolidating state.rs into db.rs if the module boundary makes sense.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:05.829396-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","database"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.30","title":"Add wortex attach command","description":"Add 'wortex attach \u003cname\u003e' command in cli.rs. Implement in commands/attach.rs using tmux attach-session to attach the user's terminal to the agent's tmux session/window. Works even after the agent has exited (tmux remain-on-exit).","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:36.221896-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","cli","interaction"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.31","title":"Add wortex mcp-serve command","description":"Add 'wortex mcp-serve' command in cli.rs. This launches an MCP server that communicates over stdio using JSON-RPC. Each spawned agent gets its own mcp-serve instance. Implement in commands/mcp.rs.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:54.595144-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","cli","mcp"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.32","title":"Implement JSON-RPC stdio transport for MCP server","description":"Implement the JSON-RPC transport layer in commands/mcp.rs. Read JSON-RPC requests from stdin, dispatch to tool handlers, write responses to stdout. Handle the MCP protocol framing.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:54.695817-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","mcp"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.33","title":"Implement wortex_list_processes MCP tool","description":"Implement the wortex_list_processes MCP tool. Returns an array of all tracked process objects with fields: name, directory, status, blocked_on, last_activity timestamp. Returns empty array when no processes exist.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:54.780971-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","mcp"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.34","title":"Implement wortex_get_process MCP tool","description":"Implement the wortex_get_process MCP tool. Takes a process name parameter. Returns full process details: name, directory, status, blocked_on, last_activity, prompt, agent persona. Returns error for unknown process names.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:54.863166-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","mcp"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.35","title":"Implement wortex_get_process_tools MCP tool","description":"Implement the wortex_get_process_tools MCP tool. Takes name and optional limit (default 50) parameters. Returns recent tool calls with: tool_name, input (JSON), timestamp, hook_type. Ordered by timestamp descending.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:54.945101-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","mcp"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.36","title":"Add MCP server config to settings.local.json injection","description":"When creating settings.local.json during process spawn, include mcpServers.wortex configuration that points to 'wortex mcp-serve'. This allows spawned agents to query wortex state via MCP tools.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:55.031454-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","mcp","spawning"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.37","title":"Handle MCP initialize/shutdown lifecycle","description":"Handle MCP lifecycle methods: respond to initialize with server capabilities and tool definitions, handle shutdown gracefully. Ensure clean teardown of resources on exit.","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:59:55.117496-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","mcp"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.38","title":"Add unit tests for database migration","description":"Unit tests for database migration logic. Test: state.json detection and import, tools.db migration, backup file creation, handling of missing/corrupted source files, schema creation in fresh wortex.db.","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T15:00:11.973204-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","testing"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.39","title":"Add unit tests for status derivation logic","description":"Unit tests for process status derivation. Test: spawned initial state, transition to active on tool events, transition to blocked on AskUserQuestion/PermissionRequest, clearing blocked on PostToolUse, transition to exited when PID is gone.","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T15:00:12.062717-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","testing"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.4","title":"Add status and blocked_on columns to processes table","description":"Add status column (TEXT, values: spawned/active/blocked/exited) and blocked_on column (TEXT, nullable, values: ask_user/permission) to the processes table schema. Default status to 'spawned' on insert.","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:05.912252-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","database"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.40","title":"Add integration test: spawn with --dir and verify settings.local.json","description":"Integration test that spawns a process with --dir, verifies the directory is used, and confirms .claude/settings.local.json is created with correct hook and MCP server configuration.","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T15:00:12.154302-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","testing"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.41","title":"Add integration test: spawn with --worktree and verify worktree created","description":"Integration test that spawns a process with --worktree, verifies a git worktree is created at the expected path, and confirms the process runs in that worktree.","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T15:00:12.241384-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","testing"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.42","title":"Add integration test: respond to blocked agent","description":"Integration test for agent interaction. Simulate an agent becoming blocked on AskUserQuestion, then use 'wortex respond' to send a reply. Verify the text is delivered and the blocked state clears.","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T15:00:12.323874-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","testing"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.43","title":"Add integration test: MCP server tool responses","description":"Integration test for MCP server. Start wortex mcp-serve, send JSON-RPC requests for list_processes, get_process, and get_process_tools. Verify correct responses including edge cases (empty list, unknown process).","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T15:00:12.406177-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","testing"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.44","title":"Add integration test: two agents in same directory","description":"Integration test that spawns two processes with --dir pointing to the same directory. Verify both are created successfully, both appear in wortex list, and both have separate settings/state tracking.","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T15:00:12.490472-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","testing"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.45","title":"Update spec.md with new commands and flags","description":"Update the main spec.md documentation with all new commands (respond, allow, deny, attach, hook, mcp-serve) and new flags (--dir, --worktree, --base). Include usage examples and error messages.","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T15:00:23.881412-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","docs"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.46","title":"Add MCP server documentation","description":"Document the MCP server: available tools (wortex_list_processes, wortex_get_process, wortex_get_process_tools), their parameters, return schemas, and how agents use them for inter-agent visibility.","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T15:00:23.978152-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","docs"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.47","title":"Document settings.local.json format and hook configuration","description":"Document the .claude/settings.local.json format that wortex injects, including hook configuration entries (PreToolUse, PostToolUse, PermissionRequest, Notification) and MCP server configuration. Explain the merge behavior when the file already exists.","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T15:00:24.059376-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","docs"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.48","title":"Migrate data storage from state.json + tools.db to unified wortex.db","description":"## Summary\n\nReplace the current split storage (`~/.wortex/state.json` for process state + `tools.db` for tool call captures) with a single unified `~/.wortex/wortex.db` SQLite database. This is the foundational change -- everything else in the agent-orchestration epic depends on this schema.\n\n## What to build\n\n### New module: `db.rs`\n\nCreate a unified SQLite schema with two tables:\n\n**processes table:**\n- id (TEXT PRIMARY KEY) - UUID\n- name (TEXT UNIQUE NOT NULL) - user-provided process name\n- directory (TEXT NOT NULL) - working directory path\n- branch (TEXT) - git branch if applicable\n- tmux_session (TEXT) - tmux session identifier\n- pid (INTEGER) - OS process ID\n- status (TEXT NOT NULL DEFAULT 'spawned') - one of: spawned, active, blocked, exited\n- blocked_on (TEXT) - nullable, one of: ask_user, permission\n- exit_code (INTEGER) - nullable, set when status=exited\n- prompt (TEXT) - the prompt used to start the agent\n- created_at (TEXT NOT NULL) - ISO 8601 timestamp\n- updated_at (TEXT NOT NULL) - ISO 8601 timestamp\n\n**tool_calls table:**\n- id (INTEGER PRIMARY KEY AUTOINCREMENT)\n- process_id (TEXT NOT NULL REFERENCES processes(id))\n- tool_name (TEXT NOT NULL)\n- tool_input (TEXT) - JSON blob of tool input\n- hook_type (TEXT NOT NULL) - one of: pre, post, permission, notification\n- timestamp (TEXT NOT NULL) - ISO 8601\n- sequence (INTEGER NOT NULL) - monotonic per process for ordering\n\nUse WAL mode for concurrent access (multiple agents read/write simultaneously). Use fs2 crate for file locking (already a dependency).\n\n### Migration logic\n\nOn first run of the new version:\n1. Check for `~/.wortex/state.json` -- if it exists, read all entries\n2. Insert each entry into the processes table in wortex.db\n3. If `tools.db` exists, copy tool_calls data into wortex.db tool_calls table (remap foreign keys)\n4. Create backups: `state.json.bak`, `tools.db.bak`\n5. Remove original files after successful migration\n6. Log each step for visibility\n\n### Refactor `state.rs`\n\nUpdate all state read/write functions to use SQLite queries against wortex.db instead of JSON serialization. Consider consolidating state.rs into db.rs if the module boundary is cleaner that way.\n\n## Key specs\n\n- See `openspec/changes/agent-orchestration/design.md` Decision 4 for rationale\n- See `openspec/changes/agent-orchestration/tasks.md` section 1\n\n## Acceptance criteria\n\n- [ ] wortex.db is created on first run with correct schema\n- [ ] Existing state.json data is migrated successfully\n- [ ] Existing tools.db data is migrated successfully\n- [ ] Old files are backed up and removed\n- [ ] All existing commands (list, status, etc.) work against the new database\n- [ ] WAL mode enabled, concurrent reads don't block\n- [ ] Unit tests cover migration from state.json and fresh initialization","status":"open","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T16:08:56.408868-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T16:08:56.408868-05:00","labels":["agent-orchestration","database"],"dependencies":[{"issue_id":"wortex-bp9.48","depends_on_id":"wortex-bp9","type":"parent-child","created_at":"2026-02-05T16:08:56.410374-05:00","created_by":"Daniel DeChiara"}]}
{"id":"wortex-bp9.49","title":"Refactor process spawning with --dir and --worktree flags","description":"## Summary\n\nDecouple process spawning from worktree creation. Currently wortex new always creates a git worktree. After this change, users choose between --dir (spawn in existing directory) or --worktree (auto-create worktree, current behavior). This also adds settings.local.json injection and WORTEX_PROCESS_ID env var.\n\n## What to build\n\n### CLI changes in `cli.rs`\n\nAdd two new mutually exclusive flags to `wortex new`:\n- `--dir \u003cpath\u003e` - spawn process in an existing directory (must exist)\n- `--worktree` - auto-create a git worktree (current behavior, requires git repo)\n- `--base \u003cbranch\u003e` - source branch for worktree (only valid with --worktree, defaults to origin/main)\n\nValidation:\n- Neither flag: error \"Must specify --dir or --worktree\"\n- Both flags: error \"--dir and --worktree are mutually exclusive\"\n- --dir with non-existent path: error \"Directory '\u003cpath\u003e' does not exist\"\n- --worktree outside git repo: error \"Not a git repository. Use --dir instead.\"\n- Duplicate process name: error \"Process '\u003cname\u003e' already exists\"\n- Multiple processes in the same directory is allowed\n\n### Refactor `commands/new.rs`\n\nSplit the spawn logic into two paths:\n1. **--dir mode**: Validate directory exists, create tmux session, run command in that directory\n2. **--worktree mode**: Create worktree at ../\u003cprefix\u003e-\u003cname\u003e, then spawn in it (preserves current behavior)\n\nBoth paths then:\n1. Create/merge `.claude/settings.local.json` in the target directory (see below)\n2. Set `WORTEX_PROCESS_ID=\u003cuuid\u003e` environment variable in the spawned process\n3. Insert process record into wortex.db with status \"spawned\"\n\n### Settings injection\n\nCreate or merge `.claude/settings.local.json` in the target directory with:\n- Hook configuration for PreToolUse, PostToolUse, PermissionRequest, Notification -- each calling `wortex hook \u003ctype\u003e $WORTEX_PROCESS_ID`\n- MCP server configuration under `mcpServers.wortex` pointing to `wortex mcp-serve`\n\nIf the file already exists, merge without overwriting existing keys. Only add/update the wortex-specific entries.\n\n## Key specs\n\n- See `openspec/changes/agent-orchestration/specs/process-spawning/spec.md` for full scenarios\n- See `openspec/changes/agent-orchestration/design.md` Decisions 5 and 6\n\n## Depends on\n\n- Database migration task (needs wortex.db schema to insert process records)\n\n## Acceptance criteria\n\n- [ ] `wortex new foo --dir /some/path --prompt \"work\"` spawns in /some/path\n- [ ] `wortex new foo --worktree --prompt \"work\"` creates worktree and spawns\n- [ ] Validation errors for missing flags, both flags, bad paths, non-git repos\n- [ ] .claude/settings.local.json created with hooks + MCP config\n- [ ] Existing settings.local.json is merged, not overwritten\n- [ ] WORTEX_PROCESS_ID set in spawned environment\n- [ ] Two processes can share the same --dir\n- [ ] Integration tests for both --dir and --worktree paths","status":"open","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T16:09:55.578624-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T16:09:55.578624-05:00","labels":["agent-orchestration","spawning"],"dependencies":[{"issue_id":"wortex-bp9.49","depends_on_id":"wortex-bp9","type":"parent-child","created_at":"2026-02-05T16:09:55.579974-05:00","created_by":"Daniel DeChiara"},{"issue_id":"wortex-bp9.49","depends_on_id":"wortex-bp9.48","type":"blocks","created_at":"2026-02-05T18:34:03.559181-05:00","created_by":"Daniel DeChiara"}]}
{"id":"wortex-bp9.5","title":"Add hook_type column to tool_calls table","description":"Add hook_type column (TEXT, values: pre/post/permission/notification) to the tool_calls table. This distinguishes between PreToolUse, PostToolUse, PermissionRequest, and Notification hook events.","status":"tombstone","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:05.997984-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","database"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.50","title":"Expand hook capture to PermissionRequest and Notification events","description":"## Summary\n\nExtend the hook system to capture two new Claude Code hook types (PermissionRequest and Notification) in addition to the existing PreToolUse/PostToolUse. All hook events now record their hook_type in the tool_calls table. Hook events drive the blocked-state detection for processes.\n\n## What to build\n\n### New hook commands\n\nAdd two new subcommands under `wortex hook`:\n\n**`wortex hook permission \u003cprocess-id\u003e`**\n- Reads JSON payload from stdin (tool_name, request details)\n- Inserts record into tool_calls with hook_type=\"permission\"\n- Sets process status to \"blocked\", blocked_on to \"permission\"\n\n**`wortex hook notification \u003cprocess-id\u003e`**\n- Reads JSON payload from stdin (message content)\n- Inserts record into tool_calls with hook_type=\"notification\"\n- Does NOT change process blocked state\n\n### Update existing hook handlers\n\nUpdate the existing PreToolUse and PostToolUse handlers:\n- Record hook_type=\"pre\" or hook_type=\"post\" in tool_calls table\n- **PreToolUse with tool_name=\"AskUserQuestion\"**: Set process status to \"blocked\", blocked_on to \"ask_user\"\n- **PostToolUse with tool_name=\"AskUserQuestion\"**: Set process status to \"active\", clear blocked_on\n- **PostToolUse generally**: If process was blocked and this is a new tool activity, clear blocked state\n\n### Hook configuration format\n\nThe hooks are configured in `.claude/settings.local.json` (injected by the spawning task). The format for each hook:\n\n```json\n{\n  \"hooks\": {\n    \"PreToolUse\": [{ \"command\": \"wortex hook pre $WORTEX_PROCESS_ID\" }],\n    \"PostToolUse\": [{ \"command\": \"wortex hook post $WORTEX_PROCESS_ID\" }],\n    \"PermissionRequest\": [{ \"command\": \"wortex hook permission $WORTEX_PROCESS_ID\" }],\n    \"Notification\": [{ \"command\": \"wortex hook notification $WORTEX_PROCESS_ID\" }]\n  }\n}\n```\n\nEach hook receives JSON on stdin from Claude Code with event details.\n\n## Key specs\n\n- See `openspec/changes/agent-orchestration/specs/hook-capture/spec.md` for full scenarios\n- See `openspec/changes/agent-orchestration/design.md` Decision 3 (blocked state detection)\n\n## Depends on\n\n- Database migration task (needs hook_type column in tool_calls)\n\n## Acceptance criteria\n\n- [ ] `wortex hook permission \u003cid\u003e` records event and sets blocked/permission\n- [ ] `wortex hook notification \u003cid\u003e` records event without changing status\n- [ ] PreToolUse(AskUserQuestion) sets blocked/ask_user\n- [ ] PostToolUse(AskUserQuestion) clears blocked state\n- [ ] All hook events include hook_type in tool_calls table\n- [ ] Hook commands parse stdin JSON correctly\n- [ ] Unit tests for each hook type and blocked-state transitions","status":"open","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T16:10:20.192604-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T16:10:20.192604-05:00","labels":["agent-orchestration","hooks"],"dependencies":[{"issue_id":"wortex-bp9.50","depends_on_id":"wortex-bp9","type":"parent-child","created_at":"2026-02-05T16:10:20.193749-05:00","created_by":"Daniel DeChiara"},{"issue_id":"wortex-bp9.50","depends_on_id":"wortex-bp9.48","type":"blocks","created_at":"2026-02-05T18:34:03.637688-05:00","created_by":"Daniel DeChiara"}]}
{"id":"wortex-bp9.51","title":"Implement process status detection and display","description":"## Summary\n\nAdd real-time process status tracking with four states (spawned, active, blocked, exited) and update the wortex status and wortex list commands to display this information. Status is derived from hook events and process liveness checks.\n\n## What to build\n\n### Status derivation logic\n\nImplement a function that derives current process status from stored state:\n\n- **spawned**: Initial state after `wortex new`. No hook events received yet.\n- **active**: Hook events (PreToolUse/PostToolUse) have been received, process is not blocked.\n- **blocked**: Last relevant hook was PreToolUse(AskUserQuestion) without PostToolUse, or PermissionRequest without resolution. Includes blocked_on field: \"ask_user\" or \"permission\".\n- **exited**: PID no longer exists. Check via `kill(pid, 0)` (libc) or equivalent. Record exit_code if available from tmux.\n\nStatus transitions are driven by hook events (see hook-capture task) and liveness checks. The derivation should be called when status is queried, not on a timer.\n\n### Process liveness check\n\nAdd a function that checks whether a process PID is still running:\n- Use `kill(pid, 0)` via the libc/nix crate -- returns Ok if process exists\n- On failure (process gone), update status to \"exited\" in wortex.db\n- Attempt to retrieve exit code from tmux pane if available\n\n### Enhanced `wortex status \u003cname\u003e`\n\nUpdate the status command output to show:\n- Process name, directory, branch\n- Status with detail: \"active\", \"blocked (waiting for input)\", \"blocked (waiting for permission)\", \"exited (code: 0)\"\n- If blocked: duration (e.g., \"blocked for 2m 34s\")\n- Last activity: tool name and timestamp (e.g., \"last tool: Read, 30s ago\")\n\n### Enhanced `wortex list`\n\nUpdate the list command to show columns:\n- NAME | STATUS | BLOCKED_ON | LAST_ACTIVITY\n- Blocked agents should stand out (e.g., show blocked_on value)\n\n## Key specs\n\n- See `openspec/changes/agent-orchestration/specs/process-status/spec.md` for full scenarios\n\n## Depends on\n\n- Database migration task (needs status and blocked_on columns)\n- Hook expansion task (hooks drive status transitions)\n\n## Acceptance criteria\n\n- [ ] New processes start with status \"spawned\"\n- [ ] Status transitions to \"active\" after first tool event\n- [ ] Status transitions to \"blocked\" on AskUserQuestion or PermissionRequest\n- [ ] Status transitions to \"exited\" when PID is gone\n- [ ] `wortex status \u003cname\u003e` shows blocked duration and last activity\n- [ ] `wortex list` shows status, blocked_on, and last activity columns\n- [ ] Liveness check correctly detects dead processes\n- [ ] Unit tests for status derivation logic","status":"open","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T16:12:06.227051-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T16:12:06.227051-05:00","labels":["agent-orchestration","status"],"dependencies":[{"issue_id":"wortex-bp9.51","depends_on_id":"wortex-bp9","type":"parent-child","created_at":"2026-02-05T16:12:06.228225-05:00","created_by":"Daniel DeChiara"},{"issue_id":"wortex-bp9.51","depends_on_id":"wortex-bp9.48","type":"blocks","created_at":"2026-02-05T18:34:03.713281-05:00","created_by":"Daniel DeChiara"},{"issue_id":"wortex-bp9.51","depends_on_id":"wortex-bp9.50","type":"blocks","created_at":"2026-02-05T18:34:03.859448-05:00","created_by":"Daniel DeChiara"}]}
{"id":"wortex-bp9.52","title":"Add agent interaction commands: respond, allow, deny, attach","description":"## Summary\n\nAdd four new CLI commands that let users interact with blocked agents without manually attaching to tmux sessions. These commands enable programmatic orchestration of multiple agents.\n\n## What to build\n\n### `wortex respond \u003cname\u003e \u003ctext\u003e`\n\nSend a text response to an agent blocked on AskUserQuestion.\n\nImplementation in `commands/respond.rs`:\n1. Look up process by name in wortex.db\n2. Validate: process exists (error: \"Agent '\u003cname\u003e' not found\")\n3. Validate: process is blocked with blocked_on=\"ask_user\" (error: \"Agent '\u003cname\u003e' is not waiting for input\")\n4. Use tmux send-keys to inject text followed by Enter into the agent's tmux pane\n5. The hook system will clear the blocked state when the agent resumes\n\n### `wortex allow \u003cname\u003e`\n\nApprove a pending permission request.\n\nImplementation in `commands/allow.rs`:\n1. Look up process by name in wortex.db\n2. Validate: process exists\n3. Validate: process is blocked with blocked_on=\"permission\" (error: \"Agent '\u003cname\u003e' has no pending permission request\")\n4. Use tmux send-keys to send \"y\" followed by Enter\n5. The hook system clears blocked state on next tool activity\n\n### `wortex deny \u003cname\u003e`\n\nReject a pending permission request.\n\nImplementation in `commands/deny.rs`:\n1. Same as allow, but sends \"n\" followed by Enter\n2. Same validation and error messages\n\n### `wortex attach \u003cname\u003e`\n\nAttach terminal to an agent's tmux session for direct interaction.\n\nImplementation in `commands/attach.rs`:\n1. Look up process by name in wortex.db\n2. Validate: process exists\n3. Run `tmux attach-session -t \u003csession\u003e` (replaces current terminal)\n4. Works even after agent exits if tmux remain-on-exit is set\n\n### Shared validation\n\nConsider a shared helper for the common pattern: look up process, validate existence, validate blocked state. The respond/allow/deny commands all follow this pattern with different blocked_on values.\n\n### CLI registration\n\nAdd all four commands to cli.rs with appropriate argument parsing:\n- `wortex respond \u003cname\u003e \u003ctext\u003e` - name and text are positional args\n- `wortex allow \u003cname\u003e` - name is positional\n- `wortex deny \u003cname\u003e` - name is positional\n- `wortex attach \u003cname\u003e` - name is positional\n\n## Key specs\n\n- See `openspec/changes/agent-orchestration/specs/agent-interaction/spec.md` for full scenarios\n\n## Depends on\n\n- Database migration (process lookup)\n- Hook expansion + status detection (blocked state must be tracked for validation)\n\n## Acceptance criteria\n\n- [ ] `wortex respond foo \"use SQLite\"` sends text to agent blocked on ask_user\n- [ ] `wortex allow foo` sends \"y\" to agent blocked on permission\n- [ ] `wortex deny foo` sends \"n\" to agent blocked on permission\n- [ ] `wortex attach foo` attaches to tmux session (works for running and exited agents)\n- [ ] Each command validates blocked state and returns clear errors\n- [ ] Non-existent agent name returns \"not found\" error\n- [ ] Wrong blocked state returns appropriate error (not waiting for input / no pending permission)\n- [ ] Integration test: respond to a blocked agent and verify it unblocks","status":"open","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T18:32:54.476564-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T18:32:54.476564-05:00","labels":["agent-orchestration","interaction"],"dependencies":[{"issue_id":"wortex-bp9.52","depends_on_id":"wortex-bp9","type":"parent-child","created_at":"2026-02-05T18:32:54.478265-05:00","created_by":"Daniel DeChiara"},{"issue_id":"wortex-bp9.52","depends_on_id":"wortex-bp9.51","type":"blocks","created_at":"2026-02-05T18:34:03.930816-05:00","created_by":"Daniel DeChiara"}]}
{"id":"wortex-bp9.53","title":"Implement MCP server for inter-agent visibility","description":"## Summary\n\nBuild an MCP (Model Context Protocol) server that agents use to discover and query other agents' status and activity. The server runs over stdio and exposes three tools: list_processes, get_process, and get_process_tools. Each spawned agent gets its own mcp-serve instance via settings.local.json configuration.\n\n## What to build\n\n### `wortex mcp-serve` command\n\nNew command in cli.rs that launches an MCP server communicating over stdio (stdin/stdout) using JSON-RPC 2.0.\n\nImplementation in `commands/mcp.rs`:\n\n**Protocol layer:**\n- Read JSON-RPC requests line-by-line from stdin\n- Parse method and params\n- Dispatch to tool handlers\n- Write JSON-RPC responses to stdout\n- Handle `initialize` (return server capabilities and tool definitions)\n- Handle `shutdown` (clean exit)\n\n**MCP SDK consideration:** Check if a Rust MCP SDK exists (e.g., `mcp-rust-sdk`). If not, implement the JSON-RPC stdio transport directly -- the protocol is straightforward (see design.md Risk section).\n\n### MCP Tools\n\n**`wortex_list_processes()`**\n- No parameters\n- Query wortex.db for all processes\n- Return array of objects: `{ name, directory, status, blocked_on, last_activity }`\n- Return empty array if no processes exist\n\n**`wortex_get_process(name: string)`**\n- Parameter: process name\n- Query wortex.db for full process details\n- Return: `{ name, directory, status, blocked_on, last_activity, prompt, branch, created_at }`\n- Return error for unknown process name\n\n**`wortex_get_process_tools(name: string, limit?: number)`**\n- Parameters: process name, optional limit (default 50)\n- Query tool_calls table ordered by timestamp DESC\n- Return array of: `{ tool_name, input (JSON), timestamp, hook_type }`\n- Return error for unknown process name\n\n### Settings integration\n\nThe spawning task (separate issue) injects MCP config into `.claude/settings.local.json`:\n\n```json\n{\n  \"mcpServers\": {\n    \"wortex\": {\n      \"command\": \"wortex\",\n      \"args\": [\"mcp-serve\"]\n    }\n  }\n}\n```\n\nThis task just needs to implement the server -- the injection is handled by the spawning task.\n\n## Key specs\n\n- See `openspec/changes/agent-orchestration/specs/agent-mcp/spec.md` for full scenarios\n- See `openspec/changes/agent-orchestration/design.md` Decision 1 (stdio per-connection)\n\n## Depends on\n\n- Database migration task (reads from wortex.db)\n\n## Acceptance criteria\n\n- [ ] `wortex mcp-serve` starts and responds to JSON-RPC over stdio\n- [ ] `initialize` returns tool definitions for all three tools\n- [ ] `wortex_list_processes` returns all tracked processes\n- [ ] `wortex_get_process` returns full details for a named process\n- [ ] `wortex_get_process_tools` returns recent tool calls with configurable limit\n- [ ] Error responses for unknown process names\n- [ ] Clean shutdown on `shutdown` method or stdin close\n- [ ] Integration test: send JSON-RPC requests and verify responses","status":"open","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T18:33:19.40158-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T18:33:19.40158-05:00","labels":["agent-orchestration","mcp"],"dependencies":[{"issue_id":"wortex-bp9.53","depends_on_id":"wortex-bp9","type":"parent-child","created_at":"2026-02-05T18:33:19.402711-05:00","created_by":"Daniel DeChiara"},{"issue_id":"wortex-bp9.53","depends_on_id":"wortex-bp9.48","type":"blocks","created_at":"2026-02-05T18:34:03.787649-05:00","created_by":"Daniel DeChiara"}]}
{"id":"wortex-bp9.54","title":"Integration tests for agent orchestration","description":"## Summary\n\nEnd-to-end integration tests that verify the agent orchestration features work together. These tests exercise the full flow: spawning, hook capture, status detection, interaction, and MCP queries. Each feature task includes its own unit tests -- this task covers the cross-cutting integration scenarios.\n\n## What to build\n\n### Spawning integration tests\n\n1. **Spawn with --dir**: Create a temp directory, run `wortex new test-agent --dir \u003ctmp\u003e --prompt \"test\"`, verify:\n   - Process record in wortex.db with correct directory\n   - `.claude/settings.local.json` exists with hooks and MCP config\n   - tmux session created\n   \n2. **Spawn with --worktree**: From a git repo, run `wortex new test-feature --worktree --prompt \"test\"`, verify:\n   - Git worktree created at expected path\n   - Process spawned in worktree directory\n\n3. **Two agents in same directory**: Spawn two processes with same --dir, verify both exist and are independently tracked\n\n### Blocked state integration tests\n\n4. **Respond to blocked agent**: Simulate blocked state by inserting a PreToolUse(AskUserQuestion) hook event, then run `wortex respond \u003cname\u003e \"answer\"`, verify:\n   - tmux send-keys was called with correct text\n   - After PostToolUse arrives, blocked state clears\n\n5. **Allow/deny permission**: Simulate PermissionRequest blocked state, run `wortex allow \u003cname\u003e`, verify tmux send-keys \"y\"\n\n### MCP integration tests\n\n6. **MCP tool responses**: Start `wortex mcp-serve` subprocess, send JSON-RPC initialize, then call each tool:\n   - `wortex_list_processes` with 0 and 2+ processes\n   - `wortex_get_process` with valid and invalid names\n   - `wortex_get_process_tools` with default and custom limits\n\n7. **Full lifecycle**: Spawn agent, simulate tool calls via hooks, query via MCP, verify status transitions\n\n### Testing approach\n\n- Use temp directories and isolated wortex.db instances\n- Clean up tmux sessions after each test\n- Consider a test helper that sets up wortex.db with known state\n- For MCP tests, spawn mcp-serve as a child process and communicate via pipes\n\n## Depends on\n\n- All implementation tasks (database, spawning, hooks, status, interaction, MCP)\n\n## Acceptance criteria\n\n- [ ] All 7 test scenarios pass\n- [ ] Tests are isolated (no shared state between tests)\n- [ ] Tests clean up tmux sessions and temp directories\n- [ ] Tests can run in CI (no interactive terminal required)","status":"open","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T18:33:52.161097-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T18:33:52.161097-05:00","labels":["agent-orchestration","testing"],"dependencies":[{"issue_id":"wortex-bp9.54","depends_on_id":"wortex-bp9","type":"parent-child","created_at":"2026-02-05T18:33:52.162261-05:00","created_by":"Daniel DeChiara"},{"issue_id":"wortex-bp9.54","depends_on_id":"wortex-bp9.49","type":"blocks","created_at":"2026-02-05T18:34:04.001079-05:00","created_by":"Daniel DeChiara"},{"issue_id":"wortex-bp9.54","depends_on_id":"wortex-bp9.50","type":"blocks","created_at":"2026-02-05T18:34:04.072984-05:00","created_by":"Daniel DeChiara"},{"issue_id":"wortex-bp9.54","depends_on_id":"wortex-bp9.51","type":"blocks","created_at":"2026-02-05T18:34:04.147845-05:00","created_by":"Daniel DeChiara"},{"issue_id":"wortex-bp9.54","depends_on_id":"wortex-bp9.52","type":"blocks","created_at":"2026-02-05T18:34:04.221463-05:00","created_by":"Daniel DeChiara"},{"issue_id":"wortex-bp9.54","depends_on_id":"wortex-bp9.53","type":"blocks","created_at":"2026-02-05T18:34:04.289033-05:00","created_by":"Daniel DeChiara"}]}
{"id":"wortex-bp9.55","title":"Update documentation for agent orchestration commands","description":"## Summary\n\nUpdate project documentation to cover all new commands, flags, and concepts introduced by agent orchestration. Target audience: developers using wortex to manage multiple agents.\n\n## What to build\n\n### CLI reference updates\n\nUpdate the main documentation (spec.md or equivalent) with:\n\n**New flags on `wortex new`:**\n- `--dir \u003cpath\u003e` - spawn in existing directory\n- `--worktree` - auto-create git worktree (previous default behavior)\n- `--base \u003cbranch\u003e` - source branch for worktree\n- Breaking change: must now specify one of --dir or --worktree\n\n**New commands:**\n- `wortex respond \u003cname\u003e \u003ctext\u003e` - send text to agent waiting for input\n- `wortex allow \u003cname\u003e` - approve pending permission request\n- `wortex deny \u003cname\u003e` - reject pending permission request\n- `wortex attach \u003cname\u003e` - attach terminal to agent tmux session\n- `wortex hook \u003ctype\u003e \u003cprocess-id\u003e` - hook handler (called by Claude Code, not users)\n- `wortex mcp-serve` - MCP server (started automatically per agent)\n\n**Updated commands:**\n- `wortex status \u003cname\u003e` - now shows blocked state and duration\n- `wortex list` - now shows status and blocked_on columns\n\n### MCP server documentation\n\nDocument the three MCP tools available to agents:\n- `wortex_list_processes()` - list all tracked processes\n- `wortex_get_process(name)` - get details for a specific process\n- `wortex_get_process_tools(name, limit)` - get recent tool call history\n\nInclude example responses and explain what agents can do with this information.\n\n### Settings.local.json format\n\nDocument the `.claude/settings.local.json` file that wortex injects:\n- Hook configuration format (PreToolUse, PostToolUse, PermissionRequest, Notification)\n- MCP server configuration format\n- Merge behavior when file already exists\n\n### Migration notes\n\nDocument the breaking change from state.json to wortex.db:\n- Automatic migration on first run\n- Backup locations\n- New --dir/--worktree requirement\n\n## Depends on\n\n- All implementation tasks (need final command signatures and behavior)\n\n## Acceptance criteria\n\n- [ ] All new commands documented with usage examples\n- [ ] All error messages documented\n- [ ] MCP tools documented with request/response examples\n- [ ] settings.local.json format documented\n- [ ] Migration path documented","status":"open","priority":2,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T18:33:52.266537-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T18:33:52.266537-05:00","labels":["agent-orchestration","docs"],"dependencies":[{"issue_id":"wortex-bp9.55","depends_on_id":"wortex-bp9","type":"parent-child","created_at":"2026-02-05T18:33:52.267477-05:00","created_by":"Daniel DeChiara"},{"issue_id":"wortex-bp9.55","depends_on_id":"wortex-bp9.49","type":"blocks","created_at":"2026-02-05T18:34:04.360846-05:00","created_by":"Daniel DeChiara"},{"issue_id":"wortex-bp9.55","depends_on_id":"wortex-bp9.52","type":"blocks","created_at":"2026-02-05T18:34:04.429633-05:00","created_by":"Daniel DeChiara"},{"issue_id":"wortex-bp9.55","depends_on_id":"wortex-bp9.53","type":"blocks","created_at":"2026-02-05T18:34:04.499852-05:00","created_by":"Daniel DeChiara"}]}
{"id":"wortex-bp9.6","title":"Add --dir flag to wortex new command","description":"Add --dir flag to wortex new in cli.rs. When provided, the process spawns in the specified directory. The directory must exist or the command fails with 'Directory \u003cpath\u003e does not exist'.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:28.664156-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","spawning"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.7","title":"Add --worktree flag to wortex new command","description":"Add --worktree flag to wortex new in cli.rs. When provided, a git worktree is auto-created at ../\u003cprefix\u003e-\u003cname\u003e from origin/main (or --base branch). Requires being in a git repo or fails with 'Not a git repository. Use --dir instead.'","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:28.751999-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","spawning"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.8","title":"Implement mutual exclusivity validation for --dir and --worktree","description":"Validate that exactly one of --dir or --worktree is provided. Neither: error 'Must specify --dir or --worktree'. Both: error '--dir and --worktree are mutually exclusive'.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:28.838674-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","spawning"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-bp9.9","title":"Refactor commands/new.rs to support --dir mode","description":"Refactor commands/new.rs so that when --dir is provided, the process spawns in the explicit directory. Create tmux session with the process running in the specified directory. No worktree creation.","status":"tombstone","priority":1,"issue_type":"task","owner":"dechiada@gmail.com","created_at":"2026-02-05T14:58:28.927754-05:00","created_by":"Daniel DeChiara","updated_at":"2026-02-05T15:59:46.050967-05:00","labels":["agent-orchestration","spawning"],"deleted_at":"2026-02-05T15:59:46.050967-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-is6","title":"Test issue with metadata","description":"\u003c!-- type: feature --\u003e","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-02-05T14:55:30.185277-05:00","updated_at":"2026-02-05T14:55:46.777701-05:00","deleted_at":"2026-02-05T14:55:46.777701-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"wortex-k1x","title":"Test issue","description":"Description here","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-02-05T14:55:07.036864-05:00","updated_at":"2026-02-05T14:55:20.37539-05:00","deleted_at":"2026-02-05T14:55:20.37539-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
